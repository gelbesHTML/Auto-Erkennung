<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Car Recognition (Teachable Machine)</title>

  <!-- Browser builds of TF.js and Teachable Machine -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.4/dist/teachablemachine-image.min.js"></script>

  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 40px auto; text-align: center; }
    #preview { max-width: 320px; display: none; margin: 20px auto; border-radius: 10px; }
    #status { color: #666; margin: 10px; }
    #result { font-size: 1.2rem; margin-top: 15px; }
  </style>
</head>
<body>
  <h1>Car Recognition</h1>
  <div id="status">Loading modelâ€¦</div>

  <input id="upload" type="file" accept="image/*" disabled />
  <br><br>
  <img id="preview" alt="Preview" />
  <div id="result"></div>

  <script>
    // ðŸ‘‰ Your Teachable Machine model URL (must end with a /)
    const MODEL_URL = "https://teachablemachine.withgoogle.com/models/gcRX6YPpt/";

    let model;

    async function loadModel() {
      try {
        model = await tmImage.load(MODEL_URL + "model.json", MODEL_URL + "metadata.json");
        document.getElementById("status").textContent = "Model loaded. Choose an image.";
        document.getElementById("upload").disabled = false;
      } catch (e) {
        document.getElementById("status").textContent = "Error loading model.";
        console.error(e);
      }
    }
    loadModel();

    document.getElementById("upload").addEventListener("change", async (event) => {
      const file = event.target.files[0];
      if (!file) return;

      const img = document.getElementById("preview");
      img.src = window.URL.createObjectURL(file);  // âœ… fixed
      img.style.display = "block";

      document.getElementById("status").textContent = "Predictingâ€¦";
      document.getElementById("result").textContent = "";

      await new Promise((resolve) => img.onload = resolve);

      const preds = await model.predict(img);
      preds.sort((a, b) => b.probability - a.probability);

      const best = preds[0];
      document.getElementById("result").textContent =
        `Prediction: ${best.className} (${(best.probability * 100).toFixed(1)}%)`;
      document.getElementById("status").textContent = "Done.";
    });
  </script>
</body>
</html>
